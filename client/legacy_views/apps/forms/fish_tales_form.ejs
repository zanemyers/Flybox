<!-- Report search form -->
<form id="form" enctype="multipart/form-data" class="p-4 border rounded bg-white shadow-sm flex-fill d-flex flex-column">

    <!-- Error messages will be injected here dynamically -->
    <div id="formError"></div>

    <div class="form-body d-block">
        <!-- API Key input -->
        <div class="form-input">
            <label for="apiKey" class="form-label">Gemini API Key</label>
            <input
                    type="password"
                    class="form-control"
                    id="apiKey"
                    name="apiKey"
                    placeholder="API key"
                    title="Your private Gemini API key"
                    required
            />
        </div>

        <!-- Maximum report age input -->
        <div class="form-input">
            <label for="maxAge" class="form-label">Max Report Age</label>
            <input
                    type="number"
                    class="form-control"
                    id="maxAge"
                    name="maxAge"
                    step="10"
                    min="10"
                    value="100"
                    placeholder="e.g. 100"
                    aria-label="Max Report Age"
                    title="Filter reports by maximum age in days (min: 10)"
                    required
            />
        </div>

        <!-- Checkbox to enable filtering by river names -->
        <div class="form-input form-check">
            <input
                    type="checkbox"
                    class="form-check-input"
                    id="filterRivers"
                    name="filterRivers"
                    title="Enable filtering of reports by river names"
            />
            <label class="form-check-label" for="filterRivers">Filter by Rivers</label>
        </div>

        <!-- River name filter input (hidden until checkbox is checked) -->
        <div id="riverListWrapper" class="form-input d-none">
            <label for="riverList" class="form-label">River Names</label>
            <input
                    type="text"
                    class="form-control"
                    id="riverList"
                    name="riverList"
                    placeholder="e.g. Madison, Snake, Yellowstone"
                    aria-label="River Names (comma-separated)"
                    title="Enter river names separated by commas to filter reports"
            />
        </div>

        <!-- File upload input (uses shared EJS partial) -->
        <div class="form-input file-input-component">
            <%- include('../../partials/file_input.ejs', { label: 'Import Starter File' }) %>
        </div>

        <!-- Advanced settings section (collapsible with <details>) -->
        <details class="form-input">
            <summary class="form-label mb-2">Advanced Settings</summary>

            <!-- Checkbox for including the sites scraped list-->
            <div class="form-input form-check">
                <input
                        type="checkbox"
                        class="form-check-input"
                        id="includeSiteList"
                        name="includeSiteList"
                        title="Output a text file listing all scraped sites"
                />
                <label class="form-check-label" for="includeSiteList">Include Site List</label>
            </div>

            <!-- Token limit per request -->
            <div class="form-input">
                <label for="tokenLimit" class="form-label">Token Limit</label>
                <input
                        type="number"
                        class="form-control"
                        id="tokenLimit"
                        name="tokenLimit"
                        placeholder="e.g. 50,000"
                        step="1000"
                        min="10000"
                        max="100000"
                        value="50000"
                        title="Maximum number of tokens per request (min: 10,000, max: 100,000)"
                        required
                />
            </div>

            <!-- Crawl depth for scraping -->
            <div class="form-input">
                <label for="crawlDepth" class="form-label">Crawl Depth</label>
                <input
                        type="number"
                        class="form-control"
                        id="crawlDepth"
                        name="crawlDepth"
                        step="5"
                        min="5"
                        max="25"
                        value="25"
                        placeholder="e.g. 25"
                        aria-label="Crawl Depth"
                        title="Set how deep the scraper follows links (min: 5, max: 25)"
                        required
                />
            </div>

            <!-- Gemini model selection -->
            <div class="form-input">
                <label for="model" class="form-label">Gemini Model</label>
                <input
                        type="text"
                        class="form-control"
                        id="model"
                        name="model"
                        value="gemini-2.5-flash"
                        placeholder="e.g. gemini-1.5-pro or gemini-2.5-flash"
                        title="Specify the Gemini model to use for summarization"
                        required
                />
            </div>

            <!-- Prompt for summarization -->
            <div class="form-input">
                <label for="summaryPrompt" class="form-label">Summary Prompt</label>
                <textarea
                        class="form-control"
                        id="summaryPrompt"
                        name="summaryPrompt"
                        placeholder="Enter summary prompt here..."
                        aria-label="Summary Prompt"
                        title="Enter the summary prompt"
                        required
                        rows="10"
                ><%= summaryPrompt %></textarea>
            </div>

            <!-- Prompt for merging summaries -->
            <div class="form-input">
                <label for="mergePrompt" class="form-label">Merge Prompt</label>
                <textarea
                        class="form-control"
                        id="mergePrompt"
                        name="mergePrompt"
                        placeholder="Enter merge prompt here..."
                        aria-label="Merge Prompt"
                        title="Enter the merge prompt"
                        required
                        rows="4"
                ><%= mergePrompt %></textarea>
            </div>

        </details>
    </div>

    <button type="submit" class="btn btn-primary mt-auto mx-1">Search & Summarize</button>
</form>

<script src="/client/src/legacy_js/fishTalesFormApp.js" type="module"></script>
