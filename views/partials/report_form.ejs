<form id="shopForm" enctype="multipart/form-data" class="pt-2 px-4 pb-4 border rounded bg-white shadow-sm flex-fill d-flex flex-column">
    <div id="formError" class="text-danger mb-3"></div>

    <div class="form-body">
        <div class="form-input">
            <label for="apiKey" class="form-label mb-0">Gemini Configuration</label>
            <div class="form-text mt-0 mb-3">
                Enter your Gemini API key, choose a model, and set the max token limit.
            </div>

            <input type="password" class="form-control mb-3" id="apiKey" name="apiKey" placeholder="API key" required/>

            <div class="d-flex g-3">
                <div class="col me-1">
                    <label for="model" class="visually-hidden">Gemini Model</label>
                    <input type="text" class="form-control" id="model" name="model" value="gemini-2.5-flash" placeholder="Model" required/>
                </div>
                <div class="col ms-1">
                    <label for="tokenLimit" class="visually-hidden">Token Limit</label>
                    <input type="number" class="form-control" id="tokenLimit" name="tokenLimit" placeholder="Token Limit" step="1000" min="10000" max="100000" value="50000"/>
                </div>
            </div>
        </div>

        <div class="form-input">
            <label class="form-label mb-0">Filter Settings</label>
            <div class="form-text mt-0 mb-3">
                Set the crawl depth for the scraper and the maximum age of reports. Optionally filter by river names.
            </div>

            <div class="d-flex g-3 mb-3">
                <input type="number" class="form-control me-1" id="crawlDepth" name="crawlDepth" step="5" min="5" value="25" required placeholder="Crawl Depth" aria-label="Crawl Depth"/>
                <input type="number" class="form-control ms-1" id="maxAge" name="maxAge" step="10" min="10" value="100" required placeholder="Max Report Age" aria-label="Max Report Age"/>
            </div>

            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="filterRivers" name="filterRivers"/>
                <label class="form-check-label" for="filterRivers">Filter by Rivers</label>
            </div>

            <div id="riverListWrapper" class="mb-3 d-none">
                <input type="text" class="form-control" id="riverList" name="riverList" placeholder="e.g. Madison, Snake, Yellowstone" aria-label="River Names (comma-separated)"/>
            </div>

            <div id="fileInputWrapper" class="pb-3">
                <%- include('./file_input.ejs', { label: 'Import Starter File' }) %>
            </div>
        </div>
    </div>

    <button type="submit" class="btn btn-primary mt-auto mx-1">Run Search</button>
</form>

<script type="text/javascript">
    document.getElementById("filterRivers").addEventListener("change", function () {
        const wrapper = document.getElementById("riverListWrapper");
        wrapper.classList.toggle("d-none", !this.checked);

        const riverListInput = document.getElementById("riverList");
        wrapper.classList.toggle("d-none", !this.checked);
        riverListInput.required = this.checked;
    });
</script>
